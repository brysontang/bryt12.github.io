<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bryson Tang | The Digital Matroid</title>
    <!-- Importing p5.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
      :root {
        --bg: #0f0f2d;
        --sidebar-bg: #0a0a20;
        --text: #c9b037;
        --link: #7393b3;
        --link-hover: #a8c4e0;
        --border: #c9b037;
        --dim-text: #8a7c45;
      }

      * {
        box-sizing: border-box;
      }

      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        background-color: var(--bg);
        color: var(--text);
        font-family:
          'Comic Sans MS', 'Comic Sans', 'Chalkboard SE', 'Comic Neue',
          sans-serif;
        overflow: hidden; /* Prevent body scroll, handle inside frames */
      }

      /* --- TYPOGRAPHY & LINKS --- */
      h1,
      h2,
      h3 {
        font-weight: normal;
        margin-top: 0;
        border-bottom: 1px solid var(--border);
        padding-bottom: 5px;
      }

      a {
        color: var(--link);
        text-decoration: underline;
        cursor: pointer;
      }

      a:hover {
        color: var(--link-hover);
        background-color: rgba(115, 147, 179, 0.1);
      }

      p {
        line-height: 1.5;
        margin-bottom: 15px;
      }

      .mono {
        font-family: 'Courier New', Courier, monospace;
        font-size: 0.9em;
      }

      /* --- BACKGROUND SKETCH --- */
      #bg-sketch-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0; /* Behind everything */
        /* Removed mix-blend-mode to allow softer overlay colors to show correctly */
        opacity: 0.5;
        pointer-events: none;
      }

      /* --- SPLASH SCREEN --- */
      #splash-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--bg);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 1s ease-out;
      }

      #splash-p5 {
        border: 2px solid var(--border);
        margin-bottom: 20px;
        box-shadow: 0 0 15px rgba(201, 176, 55, 0.2);
        width: 300px;
        height: 300px;
      }

      .enter-btn {
        font-family: 'Courier New', monospace;
        font-size: 1.5rem;
        color: var(--text);
        background: transparent;
        border: 1px solid var(--border);
        padding: 10px 20px;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.2s;
      }

      .enter-btn:hover {
        background-color: var(--border);
        color: var(--bg);
        box-shadow: 0 0 10px var(--border);
      }

      /* --- MAIN LAYOUT --- */
      #main-site {
        display: none; /* Hidden until enter */
        height: 100vh;
        width: 100vw;
        display: grid;
        grid-template-columns: 260px 1fr; /* Slightly wider sidebar for clutter */
        grid-template-rows: 100%;
        position: relative;
        z-index: 10; /* Above background */
      }

      /* Mobile Layout */
      @media (max-width: 768px) {
        #main-site {
          grid-template-columns: 1fr;
          grid-template-rows: auto 1fr;
        }
        .sidebar {
          border-right: none !important;
          border-bottom: 2px solid var(--border);
          padding: 10px !important;
          height: auto;
          max-height: 200px;
          overflow-y: auto;
        }
        .sidebar-extras {
          display: none;
        }
      }

      /* --- SIDEBAR --- */
      .sidebar {
        background-color: rgba(
          10,
          10,
          32,
          0.95
        ); /* High opacity to hide bg sketch */
        border-right: 3px double var(--border);
        padding: 15px;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        text-align: center;
        font-size: 0.9rem;
      }

      .profile-img {
        width: 100px;
        height: 100px;
        border: 2px inset var(--border);
        margin: 0 auto 10px auto;
        background-color: #000;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: var(--dim-text);
      }

      .nav-list {
        list-style-type: none;
        padding: 0;
        margin: 15px 0;
        text-align: left;
        width: 100%;
        border-top: 1px solid var(--dim-text);
        border-bottom: 1px solid var(--dim-text);
        padding: 10px 0;
      }

      .nav-item {
        margin-bottom: 5px;
      }

      .nav-link {
        display: block;
        padding: 3px 5px;
        text-decoration: none;
        font-weight: bold;
      }

      .nav-link:hover {
        background-color: var(--text);
        color: var(--bg);
        text-decoration: none;
      }

      .sidebar-module {
        margin-bottom: 15px;
        border: 1px solid var(--dim-text);
        padding: 5px;
        background: rgba(0, 0, 0, 0.3);
      }

      .module-header {
        font-family: 'Courier New';
        font-size: 0.75rem;
        background: var(--dim-text);
        color: var(--bg);
        margin: -5px -5px 5px -5px;
        padding: 2px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .hit-counter {
        font-family: 'Courier New', monospace;
        background: #000;
        border: 2px inset #555;
        color: #ff0000;
        padding: 2px 8px;
        margin: 10px auto;
        display: inline-block;
        letter-spacing: 3px;
        font-weight: bold;
        font-size: 1rem;
      }

      /* --- CONTENT FRAME --- */
      .content-frame {
        padding: 40px;
        overflow-y: auto;
        /* Transparent so background shows through */
        background: transparent;
      }

      .page-section {
        display: none;
        max-width: 800px;
        margin: 0 auto;
        border: 2px solid var(--border);
        padding: 25px;
        /* Solid enough to read, transparent enough to feel the 'void' */
        background-color: rgba(15, 15, 45, 0.92);
        box-shadow: 8px 8px 0px rgba(0, 0, 0, 0.6);
        margin-bottom: 40px;
        position: relative;
      }

      .page-section.active {
        display: block;
        animation: fadeIn 0.3s;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .date-badge {
        float: right;
        font-family: 'Courier New', monospace;
        font-size: 0.8rem;
        background: #000;
        color: var(--link);
        border: 1px solid var(--link);
        padding: 2px 5px;
        box-shadow: 2px 2px 0 var(--dim-text);
      }

      .decorative-hr {
        text-align: center;
        margin: 30px 0;
        color: var(--dim-text);
        font-size: 0.9rem;
        font-family: monospace;
      }

      .project-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        margin-top: 20px;
      }

      .project-card {
        border: 1px solid var(--dim-text);
        padding: 15px;
        background: rgba(0, 0, 0, 0.4);
      }

      .project-card h4 {
        margin-top: 0;
        color: var(--link);
        font-size: 1.1rem;
      }

      /* --- 88x31 BUTTONS --- */
      .badges-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 4px;
        margin-top: 10px;
      }

      .badge-88x31 {
        width: 88px;
        height: 31px;
        border: 1px outset #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 9px;
        font-family: 'Pixel', sans-serif;
        text-decoration: none;
        color: white !important;
        text-shadow: 1px 1px 0 #000;
        image-rendering: pixelated;
      }

      .b-claude {
        background: #d97757;
        color: #fff !important;
      }
      .b-p5 {
        background: #ed225d;
        color: #fff !important;
      }
      .b-ghostty {
        background: #1c1c1c;
        color: #fff !important;
        border-color: #333;
      }
      .b-latent {
        background: linear-gradient(to bottom, #4b0082, #000);
        color: #e6e6fa !important;
      }
      .b-ts {
        background: #3178c6;
        color: #fff !important;
      }
      .b-mlx {
        background: linear-gradient(to bottom, #888, #444);
        color: #fff !important;
      }

      .badge-notepad {
        background: linear-gradient(to bottom, #7393b3, #0f0f2d);
      }
      .badge-btc {
        background: linear-gradient(to bottom, #c9b037, #8a7c45);
      }
      .badge-w3c {
        background: linear-gradient(to bottom, #d6d6d6, #808080);
        color: black !important;
        text-shadow: none;
      }

      /* Scrollbar Styling */
      ::-webkit-scrollbar {
        width: 14px;
      }
      ::-webkit-scrollbar-track {
        background: #000;
        border-left: 1px solid var(--border);
      }
      ::-webkit-scrollbar-thumb {
        background: var(--dim-text);
        border: 2px solid #000;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: var(--text);
      }

      .marquee {
        white-space: nowrap;
        overflow: hidden;
        box-sizing: border-box;
        font-family: 'Courier New';
        font-size: 0.8rem;
      }

      .marquee span {
        display: inline-block;
        padding-left: 100%;
        animation: marquee 10s linear infinite;
      }

      @keyframes marquee {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(-100%, 0);
        }
      }
    </style>
  </head>
  <body>
    <!-- BACKGROUND P5 LAYER -->
    <div id="bg-sketch-container"></div>

    <!-- SPLASH SCREEN -->
    <div id="splash-screen">
      <div id="splash-p5"></div>
      <div
        style="
          margin-bottom: 10px;
          font-family: 'Courier New';
          color: var(--dim-text);
          margin-top: 10px;
        "
      >
        [ System Ready ]
      </div>
      <a href="#" class="enter-btn" onclick="enterSite()">ENTER ARCHIVE</a>
      <div style="margin-top: 20px; font-size: 0.8rem">Inscription #18538</div>
    </div>

    <!-- MAIN SITE LAYOUT -->
    <div id="main-site">
      <!-- SIDEBAR FRAME -->
      <aside class="sidebar">
        <div class="profile-img">◈</div>
        <h2 style="font-size: 1.2rem; border: none; margin-bottom: 0">
          B. TANG
        </h2>
        <div style="font-size: 0.7rem; color: var(--dim-text)">
          DATA ARTISAN & ARCHITECT
        </div>

        <div class="decorative-hr" style="margin: 10px 0">~ ~ ~</div>

        <div class="sidebar-module">
          <div class="module-header">Navigation</div>
          <ul class="nav-list" style="border: none; padding: 0; margin: 0">
            <li class="nav-item">
              <a class="nav-link" onclick="navigate('home')">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="navigate('lab')">The Lab</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="navigate('studio')">The Studio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="navigate('archive')">The Archive</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="navigate('guestbook')">Guestbook</a>
            </li>
          </ul>
        </div>

        <div class="sidebar-extras">
          <div class="sidebar-module">
            <div class="module-header">Listening To</div>
            <div class="marquee">
              <span>♫ Boards of Canada - Dayvan Cowboy ♫</span>
            </div>
          </div>

          <div class="sidebar-module">
            <div class="module-header">Quote</div>
            <p style="font-size: 0.75rem; font-style: italic; margin: 0">
              "The map is not the territory."<br />
              - Alfred Korzybski
            </p>
          </div>

          <div class="decorative-hr" style="margin: 15px 0">═══════</div>

          <div style="font-size: 0.8rem; margin-bottom: 5px">
            You are visitor number:
          </div>
          <div class="hit-counter">018538</div>

          <div class="decorative-hr" style="margin: 15px 0">~ ~ ~</div>

          <div style="font-size: 0.75rem; margin-bottom: 5px" class="mono">
            [ Webring ]
          </div>
          <div class="mono" style="font-size: 0.7rem">
            &lt; <a href="#">Prev</a> | <a href="#">Hub</a> |
            <a href="#">Next</a> &gt;
          </div>

          <div class="badges-container">
            <div class="badge-88x31 b-claude">CLAUDE</div>
            <div class="badge-88x31 b-ghostty">GHOSTTY</div>
            <div class="badge-88x31 b-ts">TYPESCRIPT</div>
            <div class="badge-88x31 b-latent">LATENT</div>
            <div class="badge-88x31 b-mlx">MLX</div>
            <div class="badge-88x31 b-p5">p5.js</div>
          </div>

          <div
            style="margin-top: 20px; font-size: 0.7rem; color: var(--dim-text)"
          >
            <a
              href="mailto:hello@example.com"
              style="color: var(--dim-text); text-decoration: none"
              >[ email me ]</a
            ><br /><br />
            Last Updated:<br />Dec 24, 2025
          </div>
        </div>
      </aside>

      <!-- CONTENT FRAME -->
      <main class="content-frame">
        <!-- SECTION: HOME -->
        <div id="home" class="page-section active">
          <span class="date-badge">index.html</span>
          <h1>✧ The Intersection of Rigor and Whimsy ✧</h1>
          <p>Welcome to my digital study.</p>
          <p>
            I am <strong>Bryson Tang</strong>, a Systems Architect and Data
            Artisan. In an era of black boxes and ephemeral feeds, this site
            serves as a permanent archive of my work across Data Science,
            Generative Art, and Decentralized Protocols.
          </p>
          <p>
            This space is hand-coded. No frameworks, no trackers. Just HTML,
            CSS, and a few p5.js scripts running locally in your browser. It is
            designed to be visited, not consumed.
          </p>

          <div class="decorative-hr">~ ~ ~ ◈ ~ ~ ~</div>

          <h3>Current Focus</h3>
          <ul>
            <li>
              <strong>Infrastructure:</strong> Building reproducible ML
              pipelines.
            </li>
            <li>
              <strong>Safety:</strong> Architecting identity protocols for AI
              agents.
            </li>
            <li>
              <strong>Permanence:</strong> Inscribing recursive algorithms on
              Bitcoin.
            </li>
          </ul>
        </div>

        <!-- SECTION: THE LAB -->
        <div id="lab" class="page-section">
          <span class="date-badge">/sys/engineering</span>
          <h1>[ The Lab ]</h1>
          <p>
            The domain of Applied Intelligence. Here, I build the systems that
            make AI function reliably in the real world.
          </p>

          <div class="project-grid">
            <div class="project-card">
              <h4>Bloomdesk</h4>
              <p class="mono" style="font-size: 0.8rem; color: var(--dim-text)">
                Product | AI Pipeline
              </p>
              <p>
                Addressing the "Translation Gap" between users and engineers. An
                intelligent pipeline that converts vague bug reports into
                structured, high-entropy technical tickets using LLMs.
              </p>
              <a href="#">[ View Project ]</a>
            </div>

            <div class="project-card">
              <h4>crystallize</h4>
              <p class="mono" style="font-size: 0.8rem; color: var(--dim-text)">
                MLOps | Python
              </p>
              <p>
                A lightweight framework for rigorous, reproducible data science.
                Solving the "hidden state" problem of Jupyter notebooks by
                enforcing a "Pipeline-as-Code" philosophy.
              </p>
              <a href="#">[ git clone ]</a>
            </div>

            <div class="project-card">
              <h4>agent-tokens</h4>
              <p class="mono" style="font-size: 0.8rem; color: var(--dim-text)">
                Protocol | AI Safety
              </p>
              <p>
                A standard proposal for AI Agent Identity. Shifting from
                adversarial bot detection to declared cryptographic provenance.
              </p>
              <a href="#">[ Read RFC ]</a>
            </div>
          </div>
        </div>

        <!-- SECTION: THE STUDIO -->
        <div id="studio" class="page-section">
          <span class="date-badge">/usr/creative</span>
          <h1>[ The Studio ]</h1>
          <p>
            Where code becomes a brush. Exploring emergence, recursion, and
            provenance.
          </p>

          <div class="decorative-hr">══════════════</div>

          <h3>Inscription #18,538 (The Quine)</h3>
          <p><em>Jan 2023. Bitcoin Blockchain.</em></p>
          <p>
            A recursive inscription created using a barebones node setup. No
            APIs, just raw CLI. It is a Quine—a program that outputs its own
            source code. It lives on every node in the network.
          </p>

          <div class="decorative-hr">~ ~ ~</div>

          <h3>Matroid</h3>
          <p><em>TypeScript | Nostr Protocol</em></p>
          <p>
            A decentralized curation client for generative art. Built on Nostr
            to separate identity from storage. Implements
            <strong>Kind 95</strong> events to render p5.js sketches live in the
            browser, ensuring the art is a performance, not a recording.
          </p>

          <div class="decorative-hr">~ ~ ~</div>

          <h3>Tree of Processing</h3>
          <p><em>Generative Algorithm</em></p>
          <p>
            The genesis of my artistic journey. Using recursive logic to
            generate organic forms. "The map is not the territory, but the tree
            is the seed."
          </p>
        </div>

        <!-- SECTION: THE ARCHIVE -->
        <div id="archive" class="page-section">
          <span class="date-badge">/var/logs</span>
          <h1>[ The Archive ]</h1>
          <p><em>"Noise to Signal" - Engineering Logs and System Notes.</em></p>

          <ul style="list-style-type: square; padding-left: 20px">
            <li>
              <span class="mono" style="color: var(--dim-text)"
                >[2024-11-15]</span
              >
              <a href="#"
                >The Indecisive AI: Reflections on a High School Maze Solver</a
              >
            </li>
            <li>
              <span class="mono" style="color: var(--dim-text)"
                >[2024-08-02]</span
              >
              <a href="#">Your Prompt's Favorite Prompt: LLMs as Megaphones</a>
            </li>
            <li>
              <span class="mono" style="color: var(--dim-text)"
                >[2023-01-20]</span
              >
              <a href="#"
                >Syncing the Node: A descent into barebones infrastructure</a
              >
            </li>
            <li>
              <span class="mono" style="color: var(--dim-text)"
                >[2022-12-05]</span
              >
              <a href="#"
                >Cinderella-ness: Hierarchical Cross-Validation in NCAA Data</a
              >
            </li>
            <li>
              <span class="mono" style="color: var(--dim-text)"
                >[2020-11-20]</span
              >
              <a href="#">Why I Hate Green Backgrounds (Makeover Monday)</a>
            </li>
          </ul>
        </div>

        <!-- SECTION: GUESTBOOK -->
        <div id="guestbook" class="page-section">
          <h1>[ Guestbook ]</h1>
          <p>Sign the ledger. Leave a trace.</p>

          <form
            onsubmit="
              event.preventDefault();
              alert('Entry recorded in local memory.');
            "
            style="border: 1px dashed var(--dim-text); padding: 20px"
          >
            <div style="margin-bottom: 10px">
              <label class="mono">Name: </label><br />
              <input
                type="text"
                style="
                  background: var(--bg);
                  border: 1px solid var(--border);
                  color: var(--text);
                  padding: 5px;
                  width: 100%;
                  max-width: 300px;
                "
              />
            </div>
            <div style="margin-bottom: 10px">
              <label class="mono">Message: </label><br />
              <textarea
                style="
                  background: var(--bg);
                  border: 1px solid var(--border);
                  color: var(--text);
                  padding: 5px;
                  width: 100%;
                  height: 100px;
                "
              ></textarea>
            </div>
            <button type="submit" class="enter-btn" style="font-size: 1rem">
              [ Sign Guestbook ]
            </button>
          </form>

          <div style="margin-top: 30px">
            <p
              class="mono"
              style="
                font-size: 0.8rem;
                border-bottom: 1px dotted var(--dim-text);
              "
            >
              <strong>Satoshi</strong> wrote on 2023-01-25:<br />
              Nice node setup. Keep it decentralized.
            </p>
            <p
              class="mono"
              style="
                font-size: 0.8rem;
                border-bottom: 1px dotted var(--dim-text);
              "
            >
              <strong>Visitor 402</strong> wrote on 2024-05-12:<br />
              The colors here remind me of my old GeoCities page. Great work on
              Bloomdesk.
            </p>
          </div>
        </div>

        <div
          style="
            text-align: center;
            margin-top: 50px;
            color: var(--dim-text);
            font-family: 'Courier New';
            font-size: 0.8rem;
          "
        >
          © 2025 Bryson Tang. All Rights Reserved.<br />
          <span style="font-size: 1.2rem">∞</span>
        </div>
      </main>
    </div>

    <!-- SCRIPTS -->
    <script>
      // --- NAVIGATION LOGIC ---
      function enterSite() {
        document.getElementById('splash-screen').style.opacity = '0';
        setTimeout(() => {
          document.getElementById('splash-screen').style.display = 'none';
          document.getElementById('main-site').style.display = 'grid'; // Grid for desktop
          // Re-check layout for mobile if necessary
          if (window.innerWidth <= 768) {
            document.getElementById('main-site').style.display = 'grid';
          }
        }, 1000);
      }

      function navigate(sectionId) {
        // Hide all sections
        const sections = document.querySelectorAll('.page-section');
        sections.forEach((s) => s.classList.remove('active'));

        // Show target section
        const target = document.getElementById(sectionId);
        if (target) {
          target.classList.add('active');

          // On mobile, scroll to top of content
          if (window.innerWidth <= 768) {
            document.querySelector('.content-frame').scrollTop = 0;
          }
        }
      }

      // --- INSTANCE 1: SPLASH SCREEN (Tree) ---
      var splashSketch = function (p) {
        let angle = 0;

        p.setup = function () {
          let canvas = p.createCanvas(300, 300);
          canvas.parent('splash-p5');
          p.stroke(201, 176, 55); // Gold color
          p.noFill();
        };

        p.draw = function () {
          p.background(15, 15, 45); // Match BG

          // Pulsing logic
          let pulse = p.map(p.sin(p.frameCount * 0.05), -1, 1, 0.5, 0.6);

          p.translate(p.width / 2, p.height);
          p.strokeWeight(2);
          branch(70, pulse);
        };

        function branch(h, pulse) {
          h *= 0.66;
          if (h > 2) {
            p.push();
            p.rotate(pulse);
            p.line(0, 0, 0, -h);
            p.translate(0, -h);
            branch(h, pulse);
            p.pop();

            p.push();
            p.rotate(-pulse);
            p.line(0, 0, 0, -h);
            p.translate(0, -h);
            branch(h, pulse);
            p.pop();
          }
        }
      };
      new p5(splashSketch);

      // --- INSTANCE 2: BACKGROUND WALLPAPER (Cellular Automata) ---
      var bgSketch = function (p) {
        let tiles = [];
        let w, h;
        // Larger cells for performance
        let cellW = 15;
        let off;
        let seed;

        p.setup = function () {
          let canvas = p.createCanvas(p.windowWidth, p.windowHeight);
          canvas.parent('bg-sketch-container');

          seed = p.int(p.random(10000000));
          p.noiseSeed(seed);
          p.randomSeed(seed);
          p.pixelDensity(1);
          p.angleMode(p.DEGREES);

          // Initialize Grid dimensions based on screen size
          w = p.ceil(p.width / cellW);
          h = p.ceil(p.height / cellW);

          // Initialize Tiles (Simple standard 1D array)
          let totalCells = w * h;
          tiles = new Array(totalCells);

          for (let i = 0; i < totalCells; i++) {
            // Random initialization
            tiles[i] = p.random() < 0.47;
          }

          off = p.random(10000);

          // Run Simulation Generation (Sync)
          // We run this once at startup to generate the texture
          for (var k = 0; k < 10; k++) {
            nextGen();
          }

          p.noLoop(); // Static background
        };

        p.draw = function () {
          p.clear(); // Transparent background
          p.noStroke();

          for (let j = 0; j < h; j++) {
            for (let i = 0; i < w; i++) {
              // Only draw empty spaces that are near walls
              if (!isSolid(i, j)) {
                let d = getDistanceFromWall(i, j);
                // Optimization: limit drawing to meaningful distances
                if (d > 0) {
                  p.fill(nc(d));
                  p.square(i * cellW, j * cellW, cellW);
                }
              }
            }
          }

          // Scanlines (Subtle overlay)
          // let lines = 100;
          // let dist = p.width / lines;
          // for (let i = 0; i < lines; i++) {
          //   p.stroke(0, 0, 0, 30); // Very subtle scanline
          //   p.line(i * dist, 0, i * dist, p.height);
          // }
        };

        // --- Helper Functions ---

        function nextGen() {
          let newTiles = new Array(tiles.length);
          for (let j = 0; j < h; j++) {
            for (let i = 0; i < w; i++) {
              let idx = i + j * w;
              let neighbors = getNeighbors(i, j);
              // Standard Cellular Automata Rule (4-5 Rule roughly)
              newTiles[idx] = neighbors >= 5;
            }
          }
          tiles = newTiles;
        }

        function getNeighbors(x, y) {
          let total = 0;
          for (let i = -1; i <= 1; i++) {
            for (let j = -1; j <= 1; j++) {
              // Check self and neighbors
              if (i === 0 && j === 0) continue;

              if (isSolid(x + i, y + j)) {
                total++;
              }
            }
          }
          // Add self state if logic requires it, but standard Game of Life counts neighbors.
          // The user's original logic counted "non-solid" neighbors?
          // "if (!isSolid) total += 1". Let's stick to user logic:
          // User logic: count EMPTY neighbors?
          // Let's invert to standard "solid" counting for easier logic
          // User logic: `if (!isSolid(i_ + i, j_ + j)) total += 1` -> Counting Empty Space.
          // User logic: `solid = neighbors >= 5`.
          // This implies "Stay Solid if lots of empty space around me?"
          // Let's stick to standard smoothing: if lots of solids around, become solid.
          // If I count solids:
          let solidNeighbors = 0;
          for (let i = -1; i <= 1; i++) {
            for (let j = -1; j <= 1; j++) {
              if (isSolid(x + i, y + j)) solidNeighbors++;
            }
          }
          return solidNeighbors; // Using standard logic for simpler caves
        }

        // Overriding nextGen logic to be standard cave generation:
        // If solid neighbors > 4, become solid.
        // This creates nice caves.

        function isSolid(i, j) {
          // Bounds check - Edges are solid
          if (i < 0 || j < 0 || i >= w || j >= h) {
            return true;
          }
          return tiles[i + j * w];
        }

        function getDistanceFromWall(i, j) {
          // Optimization: simplified radial check
          let dist = -1;
          let r = 1;
          let maxR = 15; // Limit check to prevent hang

          while (dist < 0 && r < maxR) {
            // Check circumference
            let circumference = p.floor(2 * p.PI * r);
            // Lower resolution check for speed
            // let steps = p.max(8, circumference / 2);

            for (var a = 0; a < 360; a += 40) {
              let x = r * p.cos(a) * 0.5 + i;
              let y = r * p.sin(a) + j;

              if (isSolid(x, y)) {
                dist = r;
              }
            }
            r++;
          }
          return dist;
        }

        function nc(d) {
          p.randomSeed(d * 100 + off);
          p.push();
          p.colorMode(p.HSL, 360, 100, 100, 1);

          // Constrain to your palette: blues (200-240) and golds (35-50)
          let hue = p.random() > 0.7 ? p.random(35, 50) : p.random(200, 260);
          let sat = p.random(70, 100);
          let lig = p.random(40, 70);
          let alp = 0.5;

          let c = p.color(hue, sat, lig, alp);
          p.pop();
          return c;
        }
        p.windowResized = function () {
          p.resizeCanvas(p.windowWidth, p.windowHeight);
          // Re-init on resize
          p.setup();
        };
      };
      new p5(bgSketch);
    </script>
  </body>
</html>
